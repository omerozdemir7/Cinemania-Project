import{c as M,d as S,e as C,a as R,b as y,s as B}from"./api-C-8Ffavt.js";import{renderPagination as v,initPagination as x}from"./pagination-T5mrxBA8.js";import{Modal as u}from"./modal-BzXhaMjf.js";import{handleSearchPageChange as I}from"./searchbar-BecLGT48.js";import"https://cdn.jsdelivr.net/npm/basiclightbox@5.0.4/+esm";const s={IMAGE_BASE_URL:"https://image.tmdb.org/t/p/w500",IMAGE_BASE_URL_2X:"https://image.tmdb.org/t/p/w780",BACKDROP_BASE_URL:"https://image.tmdb.org/t/p/w1280",BACKDROP_BASE_URL_2X:"https://image.tmdb.org/t/p/w1920",IMAGE_PLACEHOLDER:"/images/no-poster.svg"};let a,g=null;const d={lastSearch:{input:"",year:"",isSearch:!1},genresCache:[]};function U(e){return e?e.split("-")[0]:"—"}function E(e){return e?(window.devicePixelRatio>1?s.IMAGE_BASE_URL_2X:s.IMAGE_BASE_URL)+e:s.IMAGE_PLACEHOLDER}function k(e){if(!e)return s.IMAGE_PLACEHOLDER;const t=s.IMAGE_BASE_URL.replace("/w500","/w300")+e,r=s.IMAGE_BASE_URL+e;return`${t} 1x, ${r} 2x`}function T(e){return e?(window.devicePixelRatio>1?s.BACKDROP_BASE_URL_2X:s.BACKDROP_BASE_URL)+e:s.IMAGE_PLACEHOLDER}function m(e){const t=document.createElement("div");t.className="error-message error",t.textContent=e,t.style.cssText="position:fixed;top:20px;right:20px;background:rgba(0,0,0,.9);color:#fff;padding:16px 24px;border-radius:12px;z-index:10000;box-shadow:0 8px 32px rgba(0,0,0,.5);",document.body.appendChild(t),setTimeout(()=>t.remove(),4e3)}function b(e,t){if(!t)return;const r=(e||0)/2,i=Math.floor(r),c=r-i>=.5,l=5-i-(c?1:0);let n="";for(let o=0;o<i;o++)n+='<svg class="catalog-icon movie-card__icon--star"><use xlink:href="/images/symbol-defs.svg#icon-star"></use></svg>';c&&(n+='<svg class="catalog-icon movie-card__icon--star-half"><use xlink:href="/images/symbol-defs.svg#icon-star-half"></use></svg>');for(let o=0;o<l;o++)n+='<svg class="catalog-icon movie-card__icon--star-empty"><use xlink:href="/images/symbol-defs.svg#icon-star-empty"></use></svg>';t.innerHTML=n}function L(e){const t=document.getElementById("hero");if(!t||!a.heroContent)return;const r=e.backdrop_path?T(e.backdrop_path):E(e.poster_path),i=new Image;i.onload=function(){t.style.backgroundImage=`url('${r}')`,t.style.backgroundSize="cover",t.style.backgroundPosition="center",t.style.backgroundRepeat="no-repeat",t.style.backgroundAttachment="fixed",t.style.transition="background-image .3s ease"},i.src=r,a.heroContent.innerHTML=`
    <div class="hero-info">
      <h2 class="hero-title">${e.title}</h2>
      <div class="rating-stars" id="hero-rating-stars"></div>
      <p class="hero-overview">${e.overview||"No overview available."}</p>
      <div class="hero-actions">
        <button class="btn trailer-btn" data-id="${e.id}">Watch trailer</button>
        <button class="btn details-btn" data-id="${e.id}">More details</button>
      </div>
    </div>`,b(e.vote_average||0,document.getElementById("hero-rating-stars"))}function h(e){if(a.moviesUl.innerHTML="",!e||e.length===0){G();return}H();const t=document.createDocumentFragment();e.forEach(r=>t.appendChild(D(r))),a.moviesUl.appendChild(t)}function D(e){var l,n;const t=document.createElement("li");t.className="movie-card",t.dataset.id=e.id,t.style.cursor="pointer";let r="";(l=e.genres)!=null&&l.length?r=e.genres.map(o=>o.name).join(", "):(n=e.genre_ids)!=null&&n.length&&(r=e.genre_ids.map(A=>{var p;return((p=d.genresCache.find(w=>w.id===A))==null?void 0:p.name)||""}).filter(Boolean).slice(0,2).join(", "));const i=U(e.release_date),c=r?`${r} | ${i}`:i;return t.innerHTML=`
    <div class="movie-card__poster">
      <img src="${E(e.poster_path)}" alt="${e.title} poster"
           loading="lazy" srcset="${k(e.poster_path)}" />
    </div>
    <div class="movie-card__info">
      <div class="movie-card__info-left">
        <div class="movie-card__title">${e.title}</div>
        <div class="movie-card__meta">${c}</div>
      </div>
      <div class="movie-card__info-right">
        <div class="movie-card__rating"></div>
      </div>
    </div>`,b(e.vote_average||0,t.querySelector(".movie-card__rating")),t}window.renderMoviesList=h;window.renderPagination=v;async function f(e=1){var t;try{a.movieListRegion.setAttribute("aria-busy","true");const r=await C(e);if(a.heroContent&&e===1){const i=(t=r.results)==null?void 0:t[0];i&&L(i)}h(r.results||[]),v(e,r.total_pages||1),d.lastSearch={input:"",year:"",isSearch:!1}}catch(r){console.error("Error loading trending movies:",r),m("Failed to load trending movies. Please try again later.")}finally{a.movieListRegion.removeAttribute("aria-busy")}}async function P(e,t="",r=1){if(!e||e.trim()==="")return f();try{a.movieListRegion.setAttribute("aria-busy","true");const i=await B(e.trim(),t,r);h(i.results||[]),v(r,i.total_pages||1),d.lastSearch={input:e,year:t,isSearch:!0}}catch(i){console.error("Error performing search:",i),m("Search failed. Please try again.")}finally{a.movieListRegion.removeAttribute("aria-busy")}}async function $(e){if(await I(e)){window.scrollTo({top:0,behavior:"smooth"});return}d.lastSearch.isSearch?P(d.lastSearch.input,d.lastSearch.year,e):f(e),window.scrollTo({top:0,behavior:"smooth"})}function O(){g&&a.moviesUl.removeEventListener("click",g),g=async e=>{const t=e.target.closest(".movie-card");if(!t)return;const r=t.dataset.id;if(r)try{const i=await y(r);u.renderMovie(i)}catch(i){console.error("Modal open error:",i)}},a.moviesUl.addEventListener("click",g),document.addEventListener("click",async e=>{var i;const t=e.target.closest(".trailer-btn");if(t){const l=(i=(await R(t.dataset.id)).results)==null?void 0:i.find(n=>n.type==="Trailer"&&n.site==="YouTube");l?u.showTrailer(l.key):m("Trailer not available.");return}const r=e.target.closest(".details-btn");if(r){const c=await y(r.dataset.id);u.renderMovie(c)}})}async function _(){var e;try{a={moviesUl:document.getElementById("movies-ul"),heroContent:document.getElementById("hero-content"),movieListRegion:document.getElementById("movie-list"),emptyEl:document.getElementById("catalog-empty")},O(),x($);const t=await M();if(d.genresCache=t.genres||[],a.heroContent){const i=(e=(await S()).results)==null?void 0:e[0];i&&L(i)}await f(1)}catch(t){console.error("initialize error:",t),m("Failed to initialize application.")}}function G(){a.emptyEl&&(a.emptyEl.innerHTML=`
    <div class="l1">OOPS...</div>
    <div class="l1">We are very sorry!</div>
    <div class="l1">We don’t have any results matching your search.</div>`,a.emptyEl.classList.add("is-visible"),a.emptyEl.removeAttribute("hidden"))}function H(){a.emptyEl&&(a.emptyEl.classList.remove("is-visible"),a.emptyEl.setAttribute("hidden",""),a.emptyEl.innerHTML="")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",_):_();
//# sourceMappingURL=catalog-BioVXnOL.js.map
