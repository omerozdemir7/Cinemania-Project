import{c as M,d as S,e as C,a as R,b as y,s as B}from"./api-DdP_p3xO.js";import{renderPagination as v,initPagination as x}from"./pagination-T5mrxBA8.js";import{Modal as u}from"./modal-BzXhaMjf.js";import{handleSearchPageChange as I}from"./searchbar-CtWFXFen.js";import"https://cdn.jsdelivr.net/npm/basiclightbox@5.0.4/+esm";const s={IMAGE_BASE_URL:"https://image.tmdb.org/t/p/w500",IMAGE_BASE_URL_2X:"https://image.tmdb.org/t/p/w780",BACKDROP_BASE_URL:"https://image.tmdb.org/t/p/w1280",BACKDROP_BASE_URL_2X:"https://image.tmdb.org/t/p/w1920",IMAGE_PLACEHOLDER:"/Cinemania-Project/images/no-poster.svg"};let r,m=null;const d={lastSearch:{input:"",year:"",isSearch:!1},genresCache:[]};function U(e){return e?e.split("-")[0]:"—"}function E(e){return e?(window.devicePixelRatio>1?s.IMAGE_BASE_URL_2X:s.IMAGE_BASE_URL)+e:s.IMAGE_PLACEHOLDER}function P(e){if(!e)return s.IMAGE_PLACEHOLDER;const t=s.IMAGE_BASE_URL.replace("/w500","/w300")+e,i=s.IMAGE_BASE_URL+e;return`${t} 1x, ${i} 2x`}function k(e){return e?(window.devicePixelRatio>1?s.BACKDROP_BASE_URL_2X:s.BACKDROP_BASE_URL)+e:s.IMAGE_PLACEHOLDER}function g(e){const t=document.createElement("div");t.className="error-message error",t.textContent=e,t.style.cssText="position:fixed;top:20px;right:20px;background:rgba(0,0,0,.9);color:#fff;padding:16px 24px;border-radius:12px;z-index:10000;box-shadow:0 8px 32px rgba(0,0,0,.5);",document.body.appendChild(t),setTimeout(()=>t.remove(),4e3)}function b(e,t){if(!t)return;const i=(e||0)/2,a=Math.floor(i),c=i-a>=.5,l=5-a-(c?1:0);let n="";for(let o=0;o<a;o++)n+='<svg class="catalog-icon movie-card__icon--star"><use xlink:href="/Cinemania-Project/images/symbol-defs.svg#icon-star"></use></svg>';c&&(n+='<svg class="catalog-icon movie-card__icon--star-half"><use xlink:href="/Cinemania-Project/images/symbol-defs.svg#icon-star-half"></use></svg>');for(let o=0;o<l;o++)n+='<svg class="catalog-icon movie-card__icon--star-empty"><use xlink:href="/Cinemania-Project/images/symbol-defs.svg#icon-star-empty"></use></svg>';t.innerHTML=n}function L(e){const t=document.getElementById("hero");if(!t||!r.heroContent)return;const i=e.backdrop_path?k(e.backdrop_path):E(e.poster_path),a=new Image;a.onload=function(){t.style.backgroundImage=`url('${i}')`,t.style.backgroundSize="cover",t.style.backgroundPosition="center",t.style.backgroundRepeat="no-repeat",t.style.backgroundAttachment="fixed",t.style.transition="background-image .3s ease"},a.src=i,r.heroContent.innerHTML=`
    <div class="hero-info">
      <h2 class="hero-title">${e.title}</h2>
      <div class="rating-stars" id="hero-rating-stars"></div>
      <p class="hero-overview">${e.overview||"No overview available."}</p>
      <div class="hero-actions">
        <button class="btn trailer-btn" data-id="${e.id}">Watch trailer</button>
        <button class="btn details-btn" data-id="${e.id}">More details</button>
      </div>
    </div>`,b(e.vote_average||0,document.getElementById("hero-rating-stars"))}function h(e){if(r.moviesUl.innerHTML="",!e||e.length===0){G();return}H();const t=document.createDocumentFragment();e.forEach(i=>t.appendChild(T(i))),r.moviesUl.appendChild(t)}function T(e){var l,n;const t=document.createElement("li");t.className="movie-card",t.dataset.id=e.id,t.style.cursor="pointer";let i="";(l=e.genres)!=null&&l.length?i=e.genres.map(o=>o.name).join(", "):(n=e.genre_ids)!=null&&n.length&&(i=e.genre_ids.map(A=>{var p;return((p=d.genresCache.find(w=>w.id===A))==null?void 0:p.name)||""}).filter(Boolean).slice(0,2).join(", "));const a=U(e.release_date),c=i?`${i} | ${a}`:a;return t.innerHTML=`
    <div class="movie-card__poster">
      <img src="${E(e.poster_path)}" alt="${e.title} poster"
           loading="lazy" srcset="${P(e.poster_path)}" />
    </div>
    <div class="movie-card__info">
      <div class="movie-card__info-left">
        <div class="movie-card__title">${e.title}</div>
        <div class="movie-card__meta">${c}</div>
      </div>
      <div class="movie-card__info-right">
        <div class="movie-card__rating"></div>
      </div>
    </div>`,b(e.vote_average||0,t.querySelector(".movie-card__rating")),t}window.renderMoviesList=h;window.renderPagination=v;async function f(e=1){var t;try{r.movieListRegion.setAttribute("aria-busy","true");const i=await C(e);if(r.heroContent&&e===1){const a=(t=i.results)==null?void 0:t[0];a&&L(a)}h(i.results||[]),v(e,i.total_pages||1),d.lastSearch={input:"",year:"",isSearch:!1}}catch(i){console.error("Error loading trending movies:",i),g("Failed to load trending movies. Please try again later.")}finally{r.movieListRegion.removeAttribute("aria-busy")}}async function $(e,t="",i=1){if(!e||e.trim()==="")return f();try{r.movieListRegion.setAttribute("aria-busy","true");const a=await B(e.trim(),t,i);h(a.results||[]),v(i,a.total_pages||1),d.lastSearch={input:e,year:t,isSearch:!0}}catch(a){console.error("Error performing search:",a),g("Search failed. Please try again.")}finally{r.movieListRegion.removeAttribute("aria-busy")}}async function D(e){if(await I(e)){window.scrollTo({top:0,behavior:"smooth"});return}d.lastSearch.isSearch?$(d.lastSearch.input,d.lastSearch.year,e):f(e),window.scrollTo({top:0,behavior:"smooth"})}function O(){m&&r.moviesUl.removeEventListener("click",m),m=async e=>{const t=e.target.closest(".movie-card");if(!t)return;const i=t.dataset.id;if(i)try{const a=await y(i);u.renderMovie(a)}catch(a){console.error("Modal open error:",a)}},r.moviesUl.addEventListener("click",m),document.addEventListener("click",async e=>{var a;const t=e.target.closest(".trailer-btn");if(t){const l=(a=(await R(t.dataset.id)).results)==null?void 0:a.find(n=>n.type==="Trailer"&&n.site==="YouTube");l?u.showTrailer(l.key):g("Trailer not available.");return}const i=e.target.closest(".details-btn");if(i){const c=await y(i.dataset.id);u.renderMovie(c)}})}async function _(){var e;try{r={moviesUl:document.getElementById("movies-ul"),heroContent:document.getElementById("hero-content"),movieListRegion:document.getElementById("movie-list"),emptyEl:document.getElementById("catalog-empty")},O(),x(D);const t=await M();if(d.genresCache=t.genres||[],r.heroContent){const a=(e=(await S()).results)==null?void 0:e[0];a&&L(a)}await f(1)}catch(t){console.error("initialize error:",t),g("Failed to initialize application.")}}function G(){r.emptyEl&&(r.emptyEl.innerHTML=`
    <div class="l1">OOPS...</div>
    <div class="l1">We are very sorry!</div>
    <div class="l1">We don’t have any results matching your search.</div>`,r.emptyEl.classList.add("is-visible"),r.emptyEl.removeAttribute("hidden"))}function H(){r.emptyEl&&(r.emptyEl.classList.remove("is-visible"),r.emptyEl.setAttribute("hidden",""),r.emptyEl.innerHTML="")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",_):_();
//# sourceMappingURL=catalog-VJpth0uT.js.map
