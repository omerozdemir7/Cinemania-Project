{"version":3,"file":"ui-helpers-DVVtVYwK.js","sources":["../../src/app/components/trailer-modal/trailer-modal.js","../../src/app/common/ui-helpers.js"],"sourcesContent":["// Gerekli modülleri import et\r\nimport { fetchMovieVideos } from '../../data/movies-data.js';\r\n\r\n// === 1. TRAILER MODALINI AÇ (BAŞARILI) ===\r\n/**\r\n * YouTube videosunu modal içinde açar.\r\n * @param {string} videoKey - YouTube video ID'si (örn. \"dQw4w9WgXcQ\")\r\n */\r\nexport function openTrailerModal(videoKey) {\r\n  const backdrop = document.getElementById('trailer-modal-backdrop');\r\n  if (!backdrop) return;\r\n\r\n  const iframe = document.getElementById('trailer-iframe');\r\n  const closeBtn = document.getElementById('trailer-modal-close-btn');\r\n\r\n  // Iframe'e YouTube linkini (otomatik oynatmalı) bas\r\n  if (iframe) {\r\n    iframe.src = `https://www.youtube.com/embed/${videoKey}?autoplay=1&rel=0&showinfo=0`;\r\n  }\r\n\r\n  backdrop.classList.remove('is-hidden');\r\n  document.body.classList.add('modal-open'); // Arkaplan kaydırmayı durdur\r\n\r\n  // Kapatma olayları\r\n  if (closeBtn) closeBtn.onclick = () => closeTrailerModal();\r\n  backdrop.onclick = (e) => {\r\n    if (e.target === backdrop) closeTrailerModal();\r\n  };\r\n  const onEsc = (e) => {\r\n    if (e.key === 'Escape') {\r\n      closeTrailerModal(); // Fonksiyonu çağır\r\n      window.removeEventListener('keydown', onEsc); // Dinleyiciyi kaldır\r\n    }\r\n  };\r\n  window.addEventListener('keydown', onEsc);\r\n}\r\n\r\n// === 2. TRAILER MODALINI KAPAT ===\r\nexport function closeTrailerModal() {\r\n  const backdrop = document.getElementById('trailer-modal-backdrop');\r\n  const iframe = document.getElementById('trailer-iframe');\r\n  if (!backdrop) return;\r\n\r\n  backdrop.classList.add('is-hidden');\r\n  document.body.classList.remove('modal-open'); // Kaydırmayı aç\r\n  // Iframe'in src'sini temizle (video arka planda oynamasın)\r\n  if (iframe) iframe.src = '';\r\n}\r\n\r\n// === 3. \"WATCH TRAILER\" TIKLAMA YÖNETİCİSİ ===\r\n/**\r\n * Bir film ID'si alır, trailer'ı arar ve ilgili modalı açar.\r\n * (ui-helpers.js tarafından çağrılır)\r\n * @param {number|string} movieId - Film ID'si\r\n */\r\nexport async function onWatchTrailerClick(movieId) {\r\n  try {\r\n    const data = await fetchMovieVideos(movieId);\r\n    // Videoları ara: Tipi \"Trailer\" ve sitesi \"YouTube\" olanı bul\r\n    const trailer = data?.results?.find(\r\n      (v) => v.type === 'Trailer' && v.site === 'YouTube'\r\n    );\r\n\r\n    if (trailer && trailer.key) {\r\n      openTrailerModal(trailer.key); // Bulunduysa aç\r\n    } else {\r\n      openTrailerErrorModal(); // Bulunamadıysa hata modalını aç\r\n    }\r\n  } catch (error) {\r\n    console.error('Fragman aranırken hata:', error);\r\n    openTrailerErrorModal(); // API hatası olursa hata modalını aç\r\n  }\r\n}\r\n\r\n// === 4. TRAILER HATA MODALINI AÇ ===\r\nexport function openTrailerErrorModal() {\r\n  const backdrop = document.getElementById('trailer-error-backdrop');\r\n  if (!backdrop) return;\r\n\r\n  const closeBtn = document.getElementById('trailer-error-close-btn');\r\n  backdrop.classList.remove('is-hidden');\r\n  document.body.classList.add('modal-open');\r\n\r\n  // Kapatma fonksiyonu (bu modal için özel)\r\n  const closeErrorModal = () => {\r\n    backdrop.classList.add('is-hidden');\r\n    document.body.classList.remove('modal-open');\r\n    window.removeEventListener('keydown', onEsc);\r\n  };\r\n\r\n  // Kapatma olayları\r\n  if (closeBtn) closeBtn.onclick = closeErrorModal;\r\n  backdrop.onclick = (e) => {\r\n    if (e.target === backdrop) closeErrorModal();\r\n  };\r\n  const onEsc = (e) => {\r\n    if (e.key === 'Escape') closeErrorModal();\r\n  };\r\n  window.addEventListener('keydown', onEsc);\r\n}","// src/app/common/ui-helpers.js\r\n\r\nimport {\r\n  fetchMovieDetails,\r\n  fetchMovieVideos,\r\n  getImageUrl,\r\n  getOriginalImageUrl,\r\n} from \"../data/movies-data.js\";\r\nimport { openTrailerModal, openTrailerErrorModal } from \"../components/trailer-modal/trailer-modal.js\";\r\n\r\n// NOT: setupModal ve setupTeamModal'ı burada çağırmıyoruz, \r\n// onları main.js hallediyor. Burası sadece yardımcı fonksiyonlar.\r\n\r\n/* --- Yardımcılar --- */\r\nexport function getGenresText(genreData) {\r\n  if (!genreData) return \"N/A\";\r\n  \r\n  // Detay sayfasından gelen veri (Obje dizisi)\r\n  if (Array.isArray(genreData) && genreData.length > 0 && typeof genreData[0] === \"object\") {\r\n    return genreData.map((g) => g.name).slice(0, 2).join(\", \");\r\n  }\r\n\r\n  // Listeden gelen veri (ID dizisi)\r\n  const genreMap = {\r\n    28: \"Action\", 12: \"Adventure\", 16: \"Animation\", 35: \"Comedy\",\r\n    80: \"Crime\", 99: \"Documentary\", 18: \"Drama\", 10751: \"Family\",\r\n    14: \"Fantasy\", 36: \"History\", 27: \"Horror\", 10402: \"Music\",\r\n    9648: \"Mystery\", 10749: \"Romance\", 878: \"Sci-Fi\", 10770: \"TV Movie\",\r\n    53: \"Thriller\", 10752: \"War\", 37: \"Western\"\r\n  };\r\n\r\n  if (Array.isArray(genreData)) {\r\n    const genres = genreData.map((id) => genreMap[id]).filter(Boolean);\r\n    return genres.slice(0, 2).join(\", \") || \"Other\";\r\n  }\r\n  return \"N/A\";\r\n}\r\n\r\nexport function renderStars(vote) {\r\n  const stars = Math.round((vote || 0) / 2);\r\n  let html = \"\";\r\n  for (let i = 1; i <= 5; i++) {\r\n    html += `<i class=\"fa-star ${i <= stars ? \"fas active\" : \"far\"}\"></i>`;\r\n  }\r\n  return html;\r\n}\r\n\r\n/* --- Kart Render --- */\r\nexport function renderMovieCard(movie) {\r\n  const genreList = movie.genres || movie.genre_ids;\r\n  const year = movie.release_date ? new Date(movie.release_date).getFullYear() : \"N/A\";\r\n\r\n  return `\r\n    <div class=\"movie-card\" data-id=\"${movie.id}\">\r\n        <img src=\"${getImageUrl(movie.poster_path)}\" alt=\"${movie.title}\" class=\"movie-card-poster\" loading=\"lazy\">\r\n        <div class=\"movie-card-overlay\">\r\n            <h3 class=\"movie-title\">${movie.title}</h3>\r\n            <div class=\"movie-meta\">\r\n                <span class=\"movie-genre\">${getGenresText(genreList)} | ${year}</span>\r\n                <div class=\"movie-rating\">${renderStars(movie.vote_average)}</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/* --- Hero Güncelleme --- */\r\nexport async function updateHeroWithMovie(movieId, heroSection, heroContent) {\r\n  if (!heroSection || !heroContent) return;\r\n\r\n  try {\r\n    const movie = await fetchMovieDetails(movieId);\r\n    if (!movie) return;\r\n\r\n    const bg = getOriginalImageUrl(movie.backdrop_path || movie.poster_path);\r\n\r\n    heroSection.style.backgroundImage = `\r\n      linear-gradient(to right, \r\n        #111 0%, \r\n        rgba(17, 17, 17, 1) 30%, \r\n        rgba(17, 17, 17, 0.5) 50%, \r\n        transparent 100%),\r\n      url('${bg}')\r\n    `;\r\n\r\n    heroContent.innerHTML = `\r\n      <h1 class=\"hero-title\">${movie.title}</h1>\r\n      <div class=\"star-rating hero-stars\">\r\n        ${renderStars(movie.vote_average)}\r\n      </div>\r\n      <p class=\"hero-description\">${movie.overview || \"No description available.\"}</p>\r\n      <div class=\"hero-buttons\">\r\n        <button class=\"btn btn-primary\" id=\"hero-watch-trailer\" data-id=\"${movie.id}\">Watch Trailer</button>\r\n        <button class=\"btn btn-secondary\" id=\"hero-details-btn\" data-id=\"${movie.id}\">More details</button>\r\n      </div>\r\n    `;\r\n\r\n    // Event Listener'lar\r\n    const trailerBtn = heroContent.querySelector(\"#hero-watch-trailer\");\r\n    if (trailerBtn) {\r\n      trailerBtn.onclick = async (e) => {\r\n        e.preventDefault();\r\n        const id = e.target.dataset.id;\r\n        try {\r\n          const videos = await fetchMovieVideos(id);\r\n          const trailer = videos?.results?.find(v => v.type === \"Trailer\" && v.site === \"YouTube\");\r\n          if (trailer) openTrailerModal(trailer.key);\r\n          else openTrailerErrorModal();\r\n        } catch (err) {\r\n          console.error(err);\r\n          openTrailerErrorModal();\r\n        }\r\n      };\r\n    }\r\n\r\n    const detailBtn = heroContent.querySelector(\"#hero-details-btn\");\r\n    if (detailBtn) {\r\n      detailBtn.onclick = (e) => {\r\n        e.preventDefault();\r\n        const id = e.target.dataset.id;\r\n        // main.js içinde window'a atadığımız fonksiyonu kullan\r\n        if(window.openMovieModal) window.openMovieModal(id);\r\n      };\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error(\"Hero update error:\", error);\r\n  }\r\n}\r\n\r\n/* --- Upcoming Section Render --- */\r\nexport function renderUpcomingSection(movie, container) {\r\n  if (!movie || !container) return;\r\n\r\n  const releaseDate = new Date(movie.release_date).toLocaleDateString(\"en-US\");\r\n  const voteAvg = movie.vote_average ? movie.vote_average.toFixed(1) : \"N.A\";\r\n  const voteCount = movie.vote_count || 0;\r\n  const popularity = movie.popularity ? movie.popularity.toFixed(1) : \"N.A\";\r\n  const genres = getGenresText(movie.genre_ids);\r\n  const imageUrl = getOriginalImageUrl(movie.backdrop_path || movie.poster_path);\r\n  const library = JSON.parse(localStorage.getItem(\"myLibrary\")) || [];\r\n  const isAdded = library.includes(Number(movie.id));\r\n  const btnText = isAdded ? \"Remove from my library\" : \"Add to my library\";\r\n\r\n  container.innerHTML = `\r\n    <div class=\"upcoming-image\">\r\n      <img src=\"${imageUrl}\" alt=\"${movie.title}\" loading=\"lazy\" />\r\n    </div>\r\n    <div class=\"upcoming-info\">\r\n      <h3>${movie.title}</h3>\r\n      <div class=\"movie-details-list\">\r\n        <div class=\"detail-item\">\r\n          <span class=\"detail-key\">Release date</span>\r\n          <span class=\"detail-history\">${releaseDate}</span>\r\n        </div>\r\n        <div class=\"detail-item\">\r\n          <span class=\"detail-key\">Vote / Votes</span>\r\n          <span class=\"detail-value\">\r\n            <span class=\"rating-badge\">${voteAvg}</span> / ${voteCount}\r\n          </span>\r\n        </div>\r\n        <div class=\"detail-item\">\r\n          <span class=\"detail-key\">Popularity</span>\r\n          <span class=\"detail-value\">${popularity}</span>\r\n        </div>\r\n        <div class=\"detail-item\">\r\n          <span class=\"detail-key\">Genre</span>\r\n          <span class=\"detail-value\">${genres}</span>\r\n        </div>\r\n      </div>\r\n      <h4>ABOUT</h4>\r\n      <p class=\"about-text\">${movie.overview || \"No description available.\"}</p>\r\n      <button class=\"btn btn-primary btn-add-library\" id=\"upcoming-add-btn\" data-id=\"${movie.id}\">\r\n        ${btnText}\r\n      </button>\r\n    </div>\r\n  `;\r\n\r\n  const btn = container.querySelector(\"#upcoming-add-btn\");\r\n  if (btn) {\r\n    btn.onclick = () => {\r\n      const currentLib = JSON.parse(localStorage.getItem(\"myLibrary\")) || [];\r\n      const movieId = Number(btn.dataset.id);\r\n      const index = currentLib.indexOf(movieId);\r\n\r\n      if (index > -1) {\r\n        currentLib.splice(index, 1);\r\n        btn.textContent = \"Add to my library\";\r\n      } else {\r\n        currentLib.push(movieId);\r\n        btn.textContent = \"Remove from my library\";\r\n      }\r\n      localStorage.setItem(\"myLibrary\", JSON.stringify(currentLib));\r\n    };\r\n  }\r\n}"],"names":["openTrailerModal","videoKey","backdrop","iframe","closeBtn","closeTrailerModal","e","onEsc","openTrailerErrorModal","closeErrorModal","getGenresText","genreData","g","genreMap","id","renderStars","vote","stars","html","i","renderMovieCard","movie","genreList","year","getImageUrl","updateHeroWithMovie","movieId","heroSection","heroContent","fetchMovieDetails","bg","getOriginalImageUrl","trailerBtn","trailer","fetchMovieVideos","v","err","detailBtn","error","renderUpcomingSection","container","releaseDate","voteAvg","voteCount","popularity","genres","imageUrl","btnText","btn","currentLib","index"],"mappings":"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"}